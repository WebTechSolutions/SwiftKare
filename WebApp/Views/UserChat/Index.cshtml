@{
    Layout = null;

    string openTokApi = Convert.ToString(ViewBag.OpenTokApiKey);
    string openTokSession = Convert.ToString(ViewBag.OpenTokSession);
    string openTokToken = Convert.ToString(ViewBag.OpenTokToken);
}

<!DOCTYPE html>
<html lang="en">
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <!-- Meta, title, CSS, favicons, etc. -->
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <title>Video</title>

    <link href="@Url.Content("~/Content/css/bootstrap.min.css")" rel="stylesheet">
    <!-- Font Awesome -->
    @*<link href="http://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.3.0/css/font-awesome.css" rel="stylesheet" type='text/css'>*@
    <link href="@Url.Content("~/Content/css/font-awesome.min.css")" rel="stylesheet">
    <!-- NProgress -->
    <!-- iCheck -->
    <link href="@Url.Content("~/Content/css/green.css")" rel="stylesheet">
    <!-- bootstrap-progressbar -->

    <link href="@Url.Content("~/Content/css/bootstrap-progressbar-3.3.4.min.css")" rel="stylesheet">
    <link href="@Url.Content("~/Content/css/green.css")" rel="stylesheet">

    <link href="@Url.Content("~/Content/css/scroller.bootstrap.min.css")" rel="stylesheet">

    <!-- Custom Theme Style -->
    <link href="@Url.Content("~/Content/css/custom.min.css")" rel="stylesheet">
    <link href="@Url.Content("~/Content/css/style.css")" rel="stylesheet">

    <style type="text/css">
        #divPrimaryVideo {
            position: absolute;
            top: 5%;
            right: 5%;
            max-width: 200px;
            height: 160px;
            min-width: 160px;
        }

        #divSecondaryVideo {
            width: 100% !important;
            height: 100% !important;
            position: absolute;
        }

        .video_icon_bg {
            z-index: 1;
        }

        .clsHide {
            display: none !important;
        }
    </style>
</head>
<body id="video">
    <!-- <div class="video_head"></div> -->
    <div class="video_sec">
        <div id="divSecondaryVideo"></div>
        <img id="imgSecondaryVideo" class="img-responsive" src="@Url.Content("~/Content/images/123.jpg")" alt="">
        <h1 class="video_title">Muhammad Ali</h1>
        <div class="small_img">
            <a href="#" id="aHideMyCamera">
                <div id="divPrimaryVideo" class="xs-video-img img-responsive" style="display:block;"></div>
                <img id="imgPrimaryVideo" class="xs-video-img img-responsive" src="@Url.Content("~/Content/images/img.jpg")" alt="">
                <img class="video_small_icons" src="@Url.Content("~/Content/images/video_h.png")" alt="">
            </a>
            <a href="#">
                <img id="aShowMyCamera" class="small_video_icon video_small_icons" src="@Url.Content("~/Content/images/video.png")" alt="">
            </a>
        </div>

        <div class="video_icon_bg">
            <ul class="video_icon">
                <li><a href="#" class="video_pos" id="edit"><i class="fa fa-list-alt list-alt" aria-hidden="true">SOAP</i><!-- <img src="images/list_h.png" alt=""> --></a></li>
                <li><a href="#" class="video_pos_h"></a></li>

                <li><a href="#" id="aStrtCall" class="video_pos"><img src="@Url.Content("~/Content/images/phone.png")" alt=""></a></li>
                <li><a href="#" id="aStopCall" class="video_pos_h"><img src="@Url.Content("~/Content/images/phone_h.png")" alt=""></a></li>

                <li class="clsCallActive clsHide"><a href="#" id="aStopAudioPublish" class="video_pos"><img src="@Url.Content("~/Content/images/mic.png")" alt=""></a></li>
                <li class="clsCallActive clsHide"><a href="#" id="aStartAudioPublish" class="video_pos_h"><img src="@Url.Content("~/Content/images/mic_h.png")" alt=""></a></li>

                <li class="clsCallActive clsHide"><a href="#" id="aStopVideoPublish" class="video_pos"><img src="@Url.Content("~/Content/images/video.png")" alt=""></a></li>
                <li class="clsCallActive clsHide"><a href="#" id="aStartVideoPublish" class="video_pos_h"><img src="@Url.Content("~/Content/images/video_h.png")" alt=""></a></li>

                <li class="clsCallActive clsHide"><a href="#" id="aMudeAudio" class="video_pos"><img src="@Url.Content("~/Content/images/sound.png")" alt=""></a></li>
                <li class="clsCallActive clsHide"><a href="#" id="aUnMudeAudio" class="video_pos_h"><img src="@Url.Content("~/Content/images/sound_h.png")" alt=""></a></li>

                <li class="clsCallActive clsHide"><a href="#" id="aExpandVideo" class="video_pos"><img src="@Url.Content("~/Content/images/half_screen.png")" alt=""></a></li>
                <li class="clsCallActive clsHide"><a href="#" id="aShrinkExpandVideo" class="video_pos_h"><img src="@Url.Content("~/Content/images/full_screen.png")" alt=""></a></li>

                <li class="clsCallActive clsHide"><a href="#" class="video_pos" id="video-message"><i class="fa fa-comments comments" aria-hidden="true"></i></a></li>
                <li class="clsCallActive clsHide"><a href="#" class="video_pos_h"></a></li>
            </ul>
            <div class="time_salat clsCallActive clsHide">
                <p id="pTimeCounter"></p>
            </div>
        </div>
    </div>
    <div class="video_his">
        <div id="edit-sec">
            <div class="edit-sec">
                <div class="panel-group" id="accordion1" role="tablist" aria-multiselectable="true">
                    <div class="panel panel-default penal-style">
                        <div class="panel-heading" role="tab" id="headingOne">
                            <h4 class="panel-title">
                                <a data-toggle="collapse" data-parent="#accordion" href="#collapseOne" aria-expanded="true" aria-controls="collapseOne">
                                    <b style="color: #337AB7">Subjective</b>
                                    <span class="glyphicon glyphicon-chevron-right icons-pos"></span>
                                    <span class="glyphicon glyphicon-chevron-down icons-pos"></span>
                                </a>
                            </h4>
                        </div>
                        <div id="collapseOne" class="panel-collapse collapse in" role="tabpanel" aria-labelledby="headingOne">
                            <div class="panel-body">
                                <textarea class="form-control" rows="2"></textarea>
                            </div>
                        </div>
                    </div>

                    <div class="panel panel-default penal-style">
                        <div class="panel-heading" role="tab" id="headingTwo">
                            <h4 class="panel-title">
                                <a data-toggle="collapse" data-parent="#accordion" href="#collapseTwo" aria-expanded="false" aria-controls="collapseTwo">
                                    <b style="color: #337AB7">Objective</b>
                                    <span class="glyphicon glyphicon-chevron-right icons-pos"></span>
                                    <span class="glyphicon glyphicon-chevron-down icons-pos"></span>
                                </a>
                            </h4>
                        </div>
                        <div id="collapseTwo" class="panel-collapse collapse in" role="tabpanel" aria-labelledby="headingTwo">
                            <div class="panel-body">
                                <textarea class="form-control" rows="2"></textarea>
                            </div>
                        </div>
                    </div>

                    <div class="panel panel-default penal-style">
                        <div class="panel-heading" role="tab" id="headingThree">
                            <h4 class="panel-title">
                                <a data-toggle="collapse" data-parent="#accordion" href="#collapseThree" aria-expanded="false" aria-controls="collapseThree">
                                    <b style="color: #337AB7">Assessment</b>
                                    <span class="glyphicon glyphicon-chevron-right icons-pos"></span>
                                    <span class="glyphicon glyphicon-chevron-down icons-pos"></span>
                                </a>
                            </h4>
                        </div>
                        <div id="collapseThree" class="panel-collapse collapse in" role="tabpanel" aria-labelledby="headingThree">
                            <div class="panel-body">
                                <textarea class="form-control" rows="2"></textarea>
                            </div>
                        </div>
                    </div>

                    <div class="panel panel-default penal-style">
                        <div class="panel-heading" role="tab" id="headingFour">
                            <h4 class="panel-title">
                                <a data-toggle="collapse" data-parent="#accordion" href="#collapseFour" aria-expanded="false" aria-controls="collapseFour">
                                    <b style="color: #337AB7">Plan</b>
                                    <span class="glyphicon glyphicon-chevron-right icons-pos"></span>
                                    <span class="glyphicon glyphicon-chevron-down icons-pos"></span>
                                </a>
                            </h4>
                        </div>
                        <div id="collapseFour" class="panel-collapse collapse in" role="tabpanel" aria-labelledby="headingFour">
                            <div class="panel-body">
                                <textarea class="form-control" rows="2"></textarea>
                            </div>
                        </div>
                    </div>

                    <div class="panel panel-default penal-style">
                        <div class="panel-heading" role="tab" id="headingFive">
                            <h4 class="panel-title">
                                <a data-toggle="collapse" data-parent="#accordion" href="#collapseFive" aria-expanded="false" aria-controls="collapseFive">
                                    <b style="color: #337AB7">Review of Systems</b>
                                    <span class="glyphicon glyphicon-chevron-right icons-pos"></span>
                                    <span class="glyphicon glyphicon-chevron-down icons-pos"></span>
                                </a>
                            </h4>
                        </div>
                        <div id="collapseFive" class="panel-collapse collapse in" role="tabpanel" aria-labelledby="headingFive">
                            <div class="panel-body">
                                <table class="table">
                                    <tbody>
                                        <tr>
                                            <td style="border-top: 0">
                                                <h4 class="m-0">General</h4>

                                                <div class="checkbox" style="display: inline-block; width: 150px;">
                                                    <label><input checked="checked" class="flat" type="checkbox">&nbsp; fever</label>
                                                </div>


                                                <div class="checkbox" style="display: inline-block; width: 150px;">
                                                    <label><input class="flat" type="checkbox">&nbsp; chills</label>
                                                </div>


                                                <div class="checkbox" style="display: inline-block; width: 150px;">
                                                    <label><input class="flat" type="checkbox">&nbsp; malaise</label>
                                                </div>


                                                <div class="checkbox" style="display: inline-block; width: 150px;">
                                                    <label><input class="flat" type="checkbox">&nbsp; weight loss</label>
                                                </div>


                                                <div class="checkbox" style="display: inline-block; width: 150px;">
                                                    <label><input class="flat" type="checkbox">&nbsp; weight gain</label>
                                                </div>
                                            </td>
                                        </tr>

                                        <tr>
                                            <td>
                                                <h4 class="m-0">Head, Earn, Nose, Throat</h4>


                                                <div class="checkbox" style="display: inline-block; width: 150px;">
                                                    <label><input checked="checked" class="flat" type="checkbox">&nbsp; eye pain</label>
                                                </div>


                                                <div class="checkbox" style="display: inline-block; width: 150px;">
                                                    <label><input class="flat" type="checkbox">&nbsp; vision change</label>
                                                </div>


                                                <div class="checkbox" style="display: inline-block; width: 150px;">
                                                    <label><input class="flat" type="checkbox">&nbsp; ear pain</label>
                                                </div>


                                                <div class="checkbox" style="display: inline-block; width: 150px;">
                                                    <label><input class="flat" type="checkbox">&nbsp; discharge</label>
                                                </div>


                                                <div class="checkbox" style="display: inline-block; width: 150px;">
                                                    <label><input class="flat" type="checkbox">&nbsp; hearing change</label>
                                                </div>


                                                <div class="checkbox" style="display: inline-block; width: 150px;">
                                                    <label><input class="flat" type="checkbox">&nbsp; nasal congestion</label>
                                                </div>
                                            </td>
                                        </tr>


                                        <tr>
                                            <td>
                                                <h4 class="m-0">Heart</h4>


                                                <div class="checkbox" style="display: inline-block; width: 150px;">
                                                    <label><input checked="checked" class="flat" type="checkbox">&nbsp; chest pain</label>
                                                </div>


                                                <div class="checkbox" style="display: inline-block; width: 150px;">
                                                    <label><input class="flat" type="checkbox">&nbsp; SOB</label>
                                                </div>


                                                <div class="checkbox" style="display: inline-block; width: 150px;">
                                                    <label><input class="flat" type="checkbox">&nbsp; palpitations</label>
                                                </div>


                                                <div class="checkbox" style="display: inline-block; width: 150px;">
                                                    <label><input class="flat" type="checkbox">&nbsp; dizziness</label>
                                                </div>
                                            </td>
                                        </tr>


                                        <tr>
                                            <td>
                                                <h4 class="m-0">Respiratory</h4>


                                                <div class="checkbox" style="display: inline-block; width: 150px;">
                                                    <label><input checked="checked" class="flat" type="checkbox">&nbsp; cough</label>
                                                </div>


                                                <div class="checkbox" style="display: inline-block; width: 150px;">
                                                    <label><input class="flat" type="checkbox">&nbsp; wheezing</label>
                                                </div>
                                            </td>
                                        </tr>


                                        <tr>
                                            <td>
                                                <h4 class="m-0">GI</h4>


                                                <div class="checkbox" style="display: inline-block; width: 150px;">
                                                    <label><input checked="checked" class="flat" type="checkbox">&nbsp; abd pain</label>
                                                </div>


                                                <div class="checkbox" style="display: inline-block; width: 150px;">
                                                    <label><input class="flat" type="checkbox">&nbsp; nausea</label>
                                                </div>


                                                <div class="checkbox" style="display: inline-block; width: 150px;">
                                                    <label><input class="flat" type="checkbox">&nbsp; emesis</label>
                                                </div>


                                                <div class="checkbox" style="display: inline-block; width: 150px;">
                                                    <label><input class="flat" type="checkbox">&nbsp; diarrhea</label>
                                                </div>
                                            </td>
                                        </tr>


                                        <tr>
                                            <td>
                                                <h4 class="m-0">Musculoskeletal</h4>


                                                <div class="checkbox" style="display: inline-block; width: 150px;">
                                                    <label><input checked="checked" class="flat" type="checkbox">&nbsp; arthritis</label>
                                                </div>


                                                <div class="checkbox" style="display: inline-block; width: 150px;">
                                                    <label><input class="flat" type="checkbox">&nbsp; back pain</label>
                                                </div>


                                                <div class="checkbox" style="display: inline-block; width: 150px;">
                                                    <label><input class="flat" type="checkbox">&nbsp; muscle pain</label>
                                                </div>


                                                <div class="checkbox" style="display: inline-block; width: 150px;">
                                                    <label><input class="flat" type="checkbox">&nbsp; cramps</label>
                                                </div>


                                                <div class="checkbox" style="display: inline-block; width: 150px;">
                                                    <label><input class="flat" type="checkbox">&nbsp; weakness</label>
                                                </div>
                                            </td>
                                        </tr>


                                        <tr>
                                            <td>
                                                <h4 class="m-0">skin</h4>


                                                <div class="checkbox" style="display: inline-block; width: 150px;">
                                                    <label><input checked="checked" class="flat" type="checkbox">&nbsp; rash or ulcers</label>
                                                </div>
                                            </td>
                                        </tr>


                                        <tr>
                                            <td>
                                                <h4 class="m-0">Psychiatry</h4>


                                                <div class="checkbox" style="display: inline-block; width: 150px;">
                                                    <label><input checked="checked" class="flat" type="checkbox">&nbsp; anxiety</label>
                                                </div>


                                                <div class="checkbox" style="display: inline-block; width: 150px;">
                                                    <label><input class="flat" type="checkbox">&nbsp; depression</label>
                                                </div>
                                            </td>
                                        </tr>


                                        <tr>
                                            <td>
                                                <h4 class="m-0">Hematology</h4>


                                                <div class="checkbox" style="display: inline-block; width: 150px;">
                                                    <label><input checked="checked" class="flat" type="checkbox">&nbsp; bleeding problems</label>
                                                </div>
                                            </td>
                                        </tr>


                                        <tr>
                                            <td>
                                                <h4 class="m-0">Nuerology</h4>


                                                <div class="checkbox" style="display: inline-block; width: 150px;">
                                                    <label><input checked="checked" class="flat" type="checkbox">&nbsp; Siezure</label>
                                                </div>


                                                <div class="checkbox" style="display: inline-block; width: 150px;">
                                                    <label><input class="flat" type="checkbox">&nbsp; focal weakness</label>
                                                </div>
                                            </td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div id="messages-sec" class="">
            <!-- messages-sec -->
            <div id="divMessageContainer" class="msg-sec">
            </div>
            <div class="message-textarea">
                <textarea id="txtMsg" name="" placeholder="Type your messages"></textarea>
                <i id="btnSendMsg" class="messages-send fa fa-paper-plane" aria-hidden="true"></i>
            </div>
        </div>


    </div>

    @*<script src="@Url.Content("~/Scripts/offline.min.js")"></script>*@

    <!-- jQuery -->
    <script src="@Url.Content("~/Scripts/jquery.min.js")"></script>
    <!-- Bootstrap -->
    <script src="@Url.Content("~/Scripts/bootstrap.min.js")"></script>
    <!-- iCheck -->
    <script src="@Url.Content("~/Scripts/icheck.min.js")"></script>

    <script src="@Url.Content("~/Scripts/select2.full.min.js")"></script>

    <script src="@Url.Content("~/Scripts/switchery.min.js")"></script>

    <!-- starrr -->
    <!-- Custom Theme Scripts -->
    <script src="@Url.Content("~/Scripts/custom.min.js")"></script>


    <script src="https://static.opentok.com/v2/js/opentok.js" charset="utf-8"></script>

    <script type="text/javascript">

        //Declaration - Starts

        var apiKey = '@openTokApi';
        var sessionId = '@openTokSession';
        var token = '@openTokToken';

        var publisher = null;
        var subscriber = null;
        var streamCreateTime = null;
        var callInterval = null;
        var curStream = null;

        // Initialize Session Object
        var session = OT.initSession(apiKey, sessionId)
            .on('streamCreated', function (event) {
                try {

                    curStream = event.stream;
                    streamCreateTime = new Date(curStream.creationTime);
                    callInterval = setInterval(showTimeElapsed, 1000);

                    subscriber = session.subscribe(event.stream, 'divSecondaryVideo', {
                        insertMode: 'append',
                        buttonDisplayMode: 'off',
                        height: '100%',
                        width: '100%',
                        style: { buttonDisplayMode: 'off' }
                    });

                    subscriber.on("disconnected", function (event) {
                        alert("It seems another user has network issue, please wait till resolution.");
                    });

                    //For callerId use publisher's id; for calle id use subscriber's id
                    SaveSessionStart(sessionId, new Date(), 1, 1);

                } catch (e) { }
            })
            .on("streamDestroyed", function (event) {
                try {
                    //alert(event.reason);

                    if (event.reason == "networkDisconnected") {
                        //Try reconnecting till network available
                    } else {
                        stopCall();
                    }

                } catch (e) { }
            })
            .on('signal:chat', function (event) {

                var oMsgHtml = "";

                //console.log(event);
                if (event.from.connectionId === session.connection.connectionId) {
                    //my message
                    oMsgHtml = "<div class='sent-item text-right m-b-10'><img src='/Content/images/img.jpg' alt=''><div class='talk-bubble tri-right right-in margin-r'><div class='talktext'><p>";
                    oMsgHtml += event.data;
                    oMsgHtml += " <span> ";
                    oMsgHtml += getFormattedTime(new Date());
                    oMsgHtml += " </span></p> </div> </div> </div>";
                } else {
                    //their message
                    oMsgHtml += "<div class='inbox-item m-b-10'><img src='/Content/images/img.jpg' alt=''><div class='talk-bubble tri-right left-in'><div class='talktext'> <p>";
                    oMsgHtml += event.data;
                    oMsgHtml += " <span>";
                    oMsgHtml += getFormattedTime(new Date());
                    oMsgHtml += "</span></p> </div> </div> </div>";


                    //Log received message
                    SaveChatMessage(sessionId, 1, 1, event.data, new Date());
                }

                $("#divMessageContainer").append(oMsgHtml);
            });

        //Declaration - Ends


        //Event Binding - Starts
        $('#aStrtCall').click(startCall);

        $('#aStopCall').click(stopCall);

        $('#aStopAudioPublish').click(stopAudioPublish);
        $('#aStartAudioPublish').click(startAudioPublish);

        $('#aStopVideoPublish').click(stopVideoPublish);
        $('#aStartVideoPublish').click(startVideoPublish);

        $('#aMudeAudio').click(muteAudio);
        $('#aUnMudeAudio').click(unmuteAudio);

        $('#edit').click(showEditSection);
        $("#btnSendMsg").click(sendChatMessage);

        $('#aExpandVideo').click(function () {
            $('#aShrinkExpandVideo').show();
            $('#aExpandVideo').hide();
            return false;
        });

        $('#aShrinkExpandVideo').click(function () {
            $('#aShrinkExpandVideo').hide();
            $('#aExpandVideo').show();
            return false;
        });

        $('#aHideMyCamera').click(function () {
            $('#aShowMyCamera').show();
            $('#aHideMyCamera').hide();
            return false;
        });

        $('#aShowMyCamera').click(function () {
            $('#aShowMyCamera').hide();
            $('#aHideMyCamera').show();
            return false;
        });

        $('#video-message').click(function () {
            $('#messages-sec').show();
            $('#edit-sec').hide();
            $('.comments').addClass('comments-m');
            $('.list-alt').addClass('list-alt-m');
            $('.list-alt').removeClass('comments-m');
            return false;
        });

        // Update the online status icon based on connectivity
        window.addEventListener('online', intentetConnectivityRegain);
        window.addEventListener('offline', intentetConnectivityLost);

        //Event Binding - Ends


        //Functions - Starts
        function connectSession() {
            session.connect(token, function (error) {

                publisher = OT.initPublisher('divPrimaryVideo', {
                    insertMode: 'append',
                    buttonDisplayMode: 'off',
                    height: '100%',
                    width: '100%',
                    style: { buttonDisplayMode: 'off' }
                });

                if (error) {

                    console.log('There was an error connecting to the session:', error.code, error.message);

                    if (error.code == 1006) {
                        alert("You are not connected to the internet. Check your network connection.");
                    }
                }
                else {
                    session.publish(publisher);
                }
            });
        }

        function endSession() {
            session.disconnect();
        }

        function sendChatMessage() {
            session.signal({
                type: 'chat',
                data: $("#txtMsg").val()
            },
              function (error) {
                  if (!error) {
                      $("#txtMsg").val('');
                  }
              }
            );
        }

        function startCall() {
            $('#aStopCall').show();
            $('#aStrtCall').hide();

            $(".clsCallActive").removeClass("clsHide");

            connectSession();

            $("#imgPrimaryVideo").hide();
            $("#divPrimaryVideo").show();
        }

        function stopCall() {
            $('#aStrtCall').show();
            $('#aStopCall').hide();

            $(".clsCallActive").addClass("clsHide");

            endSession();

            streamCreateTime = null;
            clearInterval(callInterval);
            callInterval = null;

            $("#imgPrimaryVideo").show();
            $("#divPrimaryVideo").hide();

            $("#divMessageContainer").empty();
            $("#pTimeCounter").empty();

            showEditSection();

            //Log session ended
            SaveSessionEnd(sessionId, new Date());
        }

        function stopAudioPublish() {
            $('#aStartAudioPublish').show();
            $('#aStopAudioPublish').hide();

            publisher.publishAudio(false);
        }

        function startAudioPublish() {
            $('#aStartAudioPublish').hide();
            $('#aStopAudioPublish').show();

            publisher.publishAudio(true);
        }

        function stopVideoPublish() {
            $('#aStartVideoPublish').show();
            $('#aStopVideoPublish').hide();

            publisher.publishVideo(false);
        }
        function startVideoPublish() {
            $('#aStartVideoPublish').hide();
            $('#aStopVideoPublish').show();

            publisher.publishVideo(true);
        }

        function muteAudio() {
            $('#aUnMudeAudio').show();
            $('#aMudeAudio').hide();
            subscriber.setAudioVolume(0);
        }
        function unmuteAudio() {
            $('#aUnMudeAudio').hide();
            $('#aMudeAudio').show();
            subscriber.setAudioVolume(100);
        }


        function showEditSection() {
            $('#edit-sec').show();
            $('#messages-sec').hide();
            $('.list-alt').addClass('comments-m');
            $('.comments').removeClass('comments-m');
            $('.comments').removeClass('list-alt-m');
        }

        function showTimeElapsed() {

            if (streamCreateTime != null) {
                var today = new Date();
                var finalDisplay = "";

                var date1_ms = streamCreateTime.getTime();
                var date2_ms = today.getTime();

                var difference_sec = (date2_ms - date1_ms) / 1000;
                var seconds = parseInt(Math.floor(difference_sec % 60));
                var minutes = parseInt(Math.floor((difference_sec / 60) % 60));
                var hours = parseInt(Math.floor((difference_sec / 3600) % 60));

                if (hours > 0) {
                    finalDisplay += (hours > 9 ? hours.toString() : "0" + hours.toString()) + ":";
                }

                finalDisplay += (minutes > 9 ? minutes.toString() : "0" + minutes.toString()) + ":" + (seconds > 9 ? seconds.toString() : "0" + seconds.toString());

                $("#pTimeCounter").html(finalDisplay);
            }
        }

 
        function getFormattedTime(date) {
            var hours = date.getHours();
            var minutes = date.getMinutes();
            var ampm = hours >= 12 ? 'pm' : 'am';
            hours = hours % 12;
            hours = hours ? hours : 12; // the hour '0' should be '12'
            minutes = minutes < 10 ? '0' + minutes : minutes;
            var strTime = hours + ':' + minutes + ' ' + ampm;
            return strTime;
        }

        function intentetConnectivityLost() {
            alert("There is problem with your network connection. Please check your network connection.");
        }

        function intentetConnectivityRegain() {
            alert("Network connection has been restored. Conneting your call.");
            session.connect(token);
            session.publish(publisher);
            publisher.publishVideo(true);
        }

        //Functions - Ends


        //Database connection end points - Starts
        function SaveSessionStart(sessionId, startTime, callerId, calleId) {
            //TODO: implement save to database logic here
        }

        function SaveSessionEnd(sessionId, endTime) {
            //TODO: implement save to database logic here
        }

        function SaveChatMessage(sessionId, senderId, receiverId, message, receivedTime) {
            //TODO: implement save to database logic here
        }
        //Database connection end points - Ends

    </script>

</body>
</html>